<!DOCTYPE html>
<html>

<head>
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->

  <link rel="stylesheet" href="styles.css" type="text/css">
  <script src="jquery.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>


  <script src="dataGenerator.js"></script>

  <script src="https://unpkg.com/moment" />
  </script>


  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;700&display=swap" rel="stylesheet">
  <title>Twiddler</title>


</head>

<body>


  <!-- //JQUERY MODAL -->


  <form id="login-form" class="login_form modal" style="display: none;">
    <h2>Please login to continue.</h2>
    <h4>
      <label>Username: </label>
      <input type="text" id="username"></h4>
    <h4><label>Password: </label>
      <input type="password"></h4></br>
    <p>
      <input type="button" value="Login" id="login">
      <input type="button" value="Sign Up" id="signup">
    </p>
    <a href="#close-modal" rel="modal:close" class="close-modal ">Close</a>
  </form>


  <div class="feed">
  </div>


  <script>

    // ONLOAD
    $(document).ready(function () {

      window.visitor;


      // HEADER CLASS (Twitter Title)
      $('body').prepend('<div class="header"></div>');
      $('.header').html("<a href='index.html'><h1>ðŸ˜ŽTwiddler</h1></a>")

      // UPDATEPANEL CLASS (Text Area, Character Count, Update Button)
      $('.header').append('<div class="updatePanel"></div>');
      $('.updatePanel').html('<textarea name="text" maxlength="280" id="twitterText" placeholder="What are you up to? "></textarea>');
      $('.updatePanel').append('<div id="twitterTextCount"></div><br><button type="submit" id="tweetButton">Twiddle</button>');



      // DEFINE WINDOW VISITOR ON TEXTAREA CLICK
      $("#twitterText").click(() => {
        if (window.visitor === undefined) {
          $('#login-form').modal();


          // visitor = prompt("Enter your username:", "@");
        }
      });


      $("#login").click(() => {
        window.visitor = $("#username").val();

        $.modal.close();
        return false;
      })


      $("#signup").click(() => {
        alert('The Sign Up feature is currently unavailable.')
      })


      // CHARACTER TEXT COUNT FUNCTION (Set Max, Changes Count on Keyup)
      var textMax = 280;
      $('#twitterTextCount').html(textMax + ' characters remaining');
      $('#twitterText').keyup(() => {
        var textLength = $('#twitterText').val().length;
        var textRemaining = textMax - textLength;
        $('#twitterTextCount').html(textRemaining + ' characters remaining');
      });



      // TWITTER FEED
      var $feed = $('.feed');
      $feed.html('<div id="feedlist"></div');
      $feed.prepend('<div id="refreshlink">Refresh<img src="https://img.icons8.com/android/24/000000/refresh.png"/></div >');




      // LOADFEED FUNCTION

      const loadFeed = () => {
        var username;
        var index = streams.home.length - 1;

        while (index >= 0) {

          var tweet = streams.home[index];
          var $tweet = $('<div></div>').addClass("tweet");  // TWEET CLASS $ is representational of the jqwery dom

          $tweetUser = $('<div></div>').addClass("tweetUser"); // TWEETUSER CLASS
          $tweetUser.text('@' + tweet.user); // @USERNAME:
          $tweetUser.prependTo($tweet).append()

          var $message = $('<div></div>').addClass("message"); // MESSAGE CLASS
          $message.text(tweet.message);
          $message.appendTo($tweet);

          var $timestamp = $('<div></div)').addClass("timestamp"); // TIMESTAMP CLASS

          var date = moment(tweet.created_at);


          $timestamp.text('Posted ' + date.format("MM ddd, YYYY hh:mm:ss a"));

          // $timestamp.text('Posted on ' + tweet.created_at);
          $timestamp.appendTo($tweet);

          $tweet.appendTo('#feedlist');
          index -= 1;
        }
      }

      loadFeed();



      // TWIDDLE

      $("#tweetButton").click(() => {
        writeTweet($("#twitterText").val());
        refreshFeed();
        $("#twitterText").val("");

        // text area color change on tweet

        var randomColor1 = '#' + (Math.random() * 0xFFFFFF << 0).toString(16);
        var randomColor2 = '#' + (Math.random() * 0xFFFFFF << 0).toString(16);
        var lineargradient = "linear-gradient(246deg, " + randomColor1 + ' 24%, ' + randomColor2 + ' 100%)'

        $("#twitterText").css("background", lineargradient);


      });



      const userClick = () => {
        $(".tweetUser").click((event) => {
          var username = $(event.target).text().replace('@', '');
          usersFeedRefresh(username);
        });
      }
      userClick();


      const refreshFeed = () => {
        $("#feedlist").hide().empty().show().fadeIn('fast');
        loadFeed();
        userClick();

      }

      $("#refreshlink").click(() => {
        refreshFeed();
      });
    });




    const usersFeedRefresh = (username) => {
      // console.log(username);
      var index = streams.users[username].length - 1;

      // COMEBACK TO FIX THE FEED!
      var $feed = $('.feed');
      $feed.html('');

      $feed.prepend('<div id ="back">Back<img src="https://img.icons8.com/android/24/000000/circled-left-2.png"/></div>');

      while (index >= 0) {


        var tweet = streams.users[username][index];
        // console.log('index: ' + index + 'tweet: ' + tweet.message);

        var $tweet = $('<div></div>').addClass("tweet");  // TWEET CLASS $ is representational of the jqwery dom

        $tweetUser = $('<div></div>').addClass("tweetUser"); // TWEETUSER CLASS
        $tweetUser.text('@' + tweet.user); // @USERNAME:


        $tweetUser.prependTo($tweet);

        var $message = $('<div></div>').addClass("message"); // MESSAGE CLASS
        $message.text(tweet.message);
        $message.appendTo($tweet);

        var $timestamp = $('<div></div)').addClass("timestamp"); // TIMESTAMP CLASS
        $timestamp.text(moment().format("MM ddd, YYYY hh:mm:ss a"));
        $timestamp.appendTo($tweet);

        $tweet.appendTo($feed);
        index -= 1;
      }
    }







  </script>
  <footer>
    <p>Developed for HackReactor2020 // Made by <a href="https://github.com/lydzb123">@lydzb123</a></p>

  </footer>





</body>

</html>


<!-- Show the user new tweets somehow. (You can show them automatically as they're created, or create a button that displays new tweets.) -->
<!-- Display the timestamps of when the tweets were created. This timestamp should reflect the actual time the tweets were created, and should not just be hardcoded. -->
<!-- Design your interface so that you want to look at and use the product you're making. -->
<!-- Allow the user to click on a username to see that user's timeline. -->
<!-- Show when the tweets were created in a human-friendly way (eg "10 minutes ago"). You'll want to find and use a library for this. -->
<!-- Allow the user to tweet. -->